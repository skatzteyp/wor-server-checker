<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>WoR Server Checker</title>
        <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

        <script src="https://www.gstatic.com/firebasejs/4.6.1/firebase.js"></script>
        <script>
          // Initialize Firebase
          var config = {
            apiKey: "AIzaSyCbX9IbXUmuHG2m6OSb6iPz3ceayqEhAQ",
            authDomain: "wor-server-checker.firebaseapp.com",
            databaseURL: "https://wor-server-checker.firebaseio.com",
            projectId: "wor-server-checker",
            storageBucket: "wor-server-checker.appspot.com",
            messagingSenderId: "918009053333"
          };
          firebase.initializeApp(config);
        </script>
    </head>
    <body>
        <div>
            <p>
            Latest Server: <span id="server"></span>
            </p>
            <p>
            Server Opened: <span id="date"></span>
            </p>
        </div>
        <script>
            var date = 'No New Server',
                lastServer = 398;

            getLatestServer();

            function getLatestServer() {
                $.ajax({
                    url: 'http://cors-proxy.htmldriven.com/?url=https%3A%2F%2Fsupport.ujoy.com%2Fen%2FIndex%2FgetServersByGameId%3Fgame_id%3D17',
                    success: function(res) {
                        if (res.body) {
                            var data = JSON.parse(res.body);
                            var servers = data.data;

                            if (lastServer && lastServer != servers.length) {
                                lastServer = servers.length;
                                date = new Date();
                            }

                            $('#server').text(servers[0].REAL_NAME);
                            $('#date').text(date.toString());

                            var dbRef = firebase.database();
                            var serversRef = dbRef.ref('servers');

                            serversRef.push({
                              name: servers[0].REAL_NAME,
                              date: date.toString()
                            });
                        }

                        setTimeout(getLatestServer, 60000);
                    }
                });
            }
        </script>
    </body>
</html>
